<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Let&#x27;s Encrypt でワイルドカード証明書を発行してみたお話 | blog.comame.xyz</title><meta property="og:type" content="article"/><meta property="og:url" content="https://blog.comame.xyz/entries/2018-12-18/letsencrypt-wildcard.html"/><meta property="og:title" content="Let&#x27;s Encrypt でワイルドカード証明書を発行してみたお話 | blog.comame.xyz"/><meta property="og:site_name" content="blog.comame.xyz"/><meta property="og:description" content=""/><meta name="description" content=""/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/75b3a985ae8df8a5857d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/75b3a985ae8df8a5857d.css"/><link rel="preload" href="/_next/static/css/7e552a05a23ef38b9280.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7e552a05a23ef38b9280.css"/><link rel="preload" href="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ea5d6f7a7099b14097ba.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.136473f176143783e714.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7826aa35c5692e1bca69.js" as="script"/><link rel="preload" href="/_next/static/chunks/44192d0b83adb4471c56c08528820b1f17270e33.228b4631e982fe3bd0c5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/entries/%5Bdate%5D/%5Bid%5D-217160f5fe64bb279c4b.js" as="script"/></head><body><div id="__next"><header class="header_header__10AWY"><a href="/">blog.comame.xyz</a></header><div class="post"><div class="metadata_metadata__3aUvp"><h1 id="title">Let&#x27;s Encrypt でワイルドカード証明書を発行してみたお話</h1><time id="time">2018-12-18</time><ul class="tag-list_tag-list__1Wf57"><li><a href="/tags/security.html">security</a></li><li><a href="/tags/server.html">server</a></li></ul></div><div class="content_content__3lhGG"><p>Let's Encrypt でワイルドカード証明書を取得してみたら驚くほど簡単だったので、記事として残しておきます。</p>

<h2>ワイルドカード証明書とは</h2>

<p>ワイルドカード証明書とは、サブドメイン全てに一致する証明書です。例えば <code>*.example.com</code> で取得した証明書は、<code>sub1.example.com</code> や <code>sub2.example.com</code> に一致します 。</p>

<p>ワイルドカード証明書を使用することで、サブドメイン全てに個別の証明書を発行する手間が省けるため、管理がぐっと楽になります。</p>

<h2>手順</h2>

<p>今回は Dry Run を使用して、証明書の発行ができることを確認するだけにします。</p>

<p>ワイルドカード証明書を発行するには、DNS を使用してドメインを検証する必要があります。</p>

<pre><code>sudo certbot certonly --dry-run <b>--manual --preferred-challenges dns-01</b>
</code></pre>

<p>次に、発行先のドメインを聞かれます。<br>
<code>*.example.com</code> のように入力するだけで、自動的にワイルドカード証明書として発行してくれます。便利ですね。</p>

<pre><code>Please enter in your domain name(s) (comma and/or space separated)  (Enter 'c' to cancel):
*.example.com
</code></pre>

<p>最後にドメインの検証です。表示される案内に従って、DNS に TXT レコードを設定してください。</p>

<pre><code>Please deploy a DNS TXT record under the name
_acme-challenge.example.com with the following value:

ランダムな文字列

Before continuing, verify the record is deployed.
Press Enter to Continue
</code></pre>

<p>DNS を設定したら、エンターキーを押すと証明書が発行されます。</p>

<h2>注意事項・ハマったところ</h2>

<h3>サブドメインにしか適用されない</h3>

<p>先程は <code>*.example.com</code> に対して証明書を発行しましたが、この証明書は <code>example.com</code> には使用できません。</p>

<p><code>example.com</code> にも対応する証明書を作成するには、次のようにします。</p>

<pre><code>Please enter in your domain name(s) (comma and/or space separated)  (Enter 'c' to cancel):
<b>*.example.com example.com</b></code></pre>

<h3>証明書の自動更新がめんどい</h3>

<p>ワイルドカード証明書を発行するときに <code>--manual</code> を指定する必要がありましたが、この影響でいつもどおり <code>sudo certbot renew</code> しても怒られてしまいます。シェルスクリプトを作成して、引数に渡す必要があるみたいです。</p>

<p>デフォルトの certbot の設定では自動更新がなされないので、注意が必要です。</p>
</div><div class="share_share__2h1cH"><img alt="共有" src="/icons/share.svg"/><a rel="noopener" target="_blank" title="Twitter で共有" href="https://twitter.com/intent/tweet?text=Let&#x27;s%20Encrypt%20%E3%81%A7%E3%83%AF%E3%82%A4%E3%83%AB%E3%83%89%E3%82%AB%E3%83%BC%E3%83%89%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E3%81%8A%E8%A9%B1%0a&amp;url=https%3A%2F%2Fblog.comame.xyz%2Fentries%2F2018-12-18%2Fletsencrypt-wildcard.html&amp;related=comameito"><img alt="Twitter で共有" src="/icons/twitter_logo.svg"/></a><a rel="noopener" target="_blank" title="Facebook で共有" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.comame.xyz%2Fentries%2F2018-12-18%2Fletsencrypt-wildcard.html"><img alt="Facebook で共有" src="/icons/facebook_logo.svg"/></a><a title="URL をコピー" id="url-copy"><img alt="URL をコピー" src="/icons/link.svg"/></a><script async="" src="/js/url-copy.js"></script></div></div><footer class="footer_footer__cDy4s"><small><a href="https://github.com/comame/blog.comame.xyz" target="_blank" rel="noopener"><img alt="GitHub Actions build status" id="build-status" src="https://github.com/comame/blog.comame.xyz/workflows/Build/badge.svg?event=push"/></a></small><small><span>Copyright 2020 <a href="https://comame.xyz">comame</a></span><span><a target="_blank" rel="noopener" href="https://github.com/comame/blog.comame.xyz/blob/master/archives/2018/letsencrypt-wildcard.html">source</a></span><span><a target="_blank" rel="noopener" href="https://github.com/comame/blog.comame.xyz/commits/master/archives/2018/letsencrypt-wildcard.html">history</a></span><span><a href="/feed.xml">Feed</a></span></small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"entry":{"entry":"letsencrypt-wildcard","title":"Let's Encrypt でワイルドカード証明書を発行してみたお話","date":"2018-12-18","tags":["security","server"],"type":"html"},"text":"\u003cp\u003eLet's Encrypt でワイルドカード証明書を取得してみたら驚くほど簡単だったので、記事として残しておきます。\u003c/p\u003e\n\n\u003ch2\u003eワイルドカード証明書とは\u003c/h2\u003e\n\n\u003cp\u003eワイルドカード証明書とは、サブドメイン全てに一致する証明書です。例えば \u003ccode\u003e*.example.com\u003c/code\u003e で取得した証明書は、\u003ccode\u003esub1.example.com\u003c/code\u003e や \u003ccode\u003esub2.example.com\u003c/code\u003e に一致します 。\u003c/p\u003e\n\n\u003cp\u003eワイルドカード証明書を使用することで、サブドメイン全てに個別の証明書を発行する手間が省けるため、管理がぐっと楽になります。\u003c/p\u003e\n\n\u003ch2\u003e手順\u003c/h2\u003e\n\n\u003cp\u003e今回は Dry Run を使用して、証明書の発行ができることを確認するだけにします。\u003c/p\u003e\n\n\u003cp\u003eワイルドカード証明書を発行するには、DNS を使用してドメインを検証する必要があります。\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003esudo certbot certonly --dry-run \u003cb\u003e--manual --preferred-challenges dns-01\u003c/b\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003e次に、発行先のドメインを聞かれます。\u003cbr\u003e\n\u003ccode\u003e*.example.com\u003c/code\u003e のように入力するだけで、自動的にワイルドカード証明書として発行してくれます。便利ですね。\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ePlease enter in your domain name(s) (comma and/or space separated)  (Enter 'c' to cancel):\n*.example.com\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003e最後にドメインの検証です。表示される案内に従って、DNS に TXT レコードを設定してください。\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ePlease deploy a DNS TXT record under the name\n_acme-challenge.example.com with the following value:\n\nランダムな文字列\n\nBefore continuing, verify the record is deployed.\nPress Enter to Continue\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eDNS を設定したら、エンターキーを押すと証明書が発行されます。\u003c/p\u003e\n\n\u003ch2\u003e注意事項・ハマったところ\u003c/h2\u003e\n\n\u003ch3\u003eサブドメインにしか適用されない\u003c/h3\u003e\n\n\u003cp\u003e先程は \u003ccode\u003e*.example.com\u003c/code\u003e に対して証明書を発行しましたが、この証明書は \u003ccode\u003eexample.com\u003c/code\u003e には使用できません。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eexample.com\u003c/code\u003e にも対応する証明書を作成するには、次のようにします。\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ePlease enter in your domain name(s) (comma and/or space separated)  (Enter 'c' to cancel):\n\u003cb\u003e*.example.com example.com\u003c/b\u003e\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch3\u003e証明書の自動更新がめんどい\u003c/h3\u003e\n\n\u003cp\u003eワイルドカード証明書を発行するときに \u003ccode\u003e--manual\u003c/code\u003e を指定する必要がありましたが、この影響でいつもどおり \u003ccode\u003esudo certbot renew\u003c/code\u003e しても怒られてしまいます。シェルスクリプトを作成して、引数に渡す必要があるみたいです。\u003c/p\u003e\n\n\u003cp\u003eデフォルトの certbot の設定では自動更新がなされないので、注意が必要です。\u003c/p\u003e\n"},"__N_SSG":true},"page":"/entries/[date]/[id]","query":{"date":"2018-12-18","id":"letsencrypt-wildcard"},"buildId":"wnamPQHDVPDVf2bkZ8EMU","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e750b8bf0c81a657f011.js"></script><script src="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" async=""></script><script src="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" async=""></script><script src="/_next/static/chunks/framework.ea5d6f7a7099b14097ba.js" async=""></script><script src="/_next/static/chunks/commons.136473f176143783e714.js" async=""></script><script src="/_next/static/chunks/pages/_app-7826aa35c5692e1bca69.js" async=""></script><script src="/_next/static/chunks/44192d0b83adb4471c56c08528820b1f17270e33.228b4631e982fe3bd0c5.js" async=""></script><script src="/_next/static/chunks/pages/entries/%5Bdate%5D/%5Bid%5D-217160f5fe64bb279c4b.js" async=""></script><script src="/_next/static/wnamPQHDVPDVf2bkZ8EMU/_buildManifest.js" async=""></script><script src="/_next/static/wnamPQHDVPDVf2bkZ8EMU/_ssgManifest.js" async=""></script></body></html>