<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ブログシステムを新しくした (Blogger からの移行) | blog.comame.xyz</title><meta property="og:type" content="article"/><meta property="og:url" content="https://blog.comame.xyz/entries/2020-03-07/new-blog-system.html"/><meta property="og:title" content="ブログシステムを新しくした (Blogger からの移行) | blog.comame.xyz"/><meta property="og:site_name" content="blog.comame.xyz"/><meta property="og:description" content=""/><meta name="description" content=""/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/75b3a985ae8df8a5857d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/75b3a985ae8df8a5857d.css"/><link rel="preload" href="/_next/static/css/7e552a05a23ef38b9280.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7e552a05a23ef38b9280.css"/><link rel="preload" href="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ea5d6f7a7099b14097ba.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.136473f176143783e714.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7826aa35c5692e1bca69.js" as="script"/><link rel="preload" href="/_next/static/chunks/44192d0b83adb4471c56c08528820b1f17270e33.228b4631e982fe3bd0c5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/entries/%5Bdate%5D/%5Bid%5D-217160f5fe64bb279c4b.js" as="script"/></head><body><div id="__next"><header class="header_header__10AWY"><a href="/">blog.comame.xyz</a></header><div class="post"><div class="metadata_metadata__3aUvp"><h1 id="title">ブログシステムを新しくした (Blogger からの移行)</h1><time id="time">2020-03-07</time><ul class="tag-list_tag-list__1Wf57"><li><a href="/tags/Blog.html">Blog</a></li></ul></div><div class="content_content__3lhGG"><p>新しいブログシステムを作成して、Blogger から移行した。今は静的ファイルとして静的ファイルサーバから配信している。GitHub でソースコードを公開した。<a href="https://github.com/comame/blog.comame.xyz" target="_blank">comame/blog.comame.xyz</a></p>

<h2>モチベーション</h2>
<ul>
    <li>自分が制御可能な形でデータを置きたかった</li>
    <li>自分の慣れているエディタで HTML を書きたかった</li>
    <li>Blogger は読み込み速度が少し遅かった</li>
</ul>

<h2>仕組み</h2>

<h3>記事の管理</h3>
<p><a target='_blank' href="https://github.com/comame/blog.comame.xyz/tree/master/archives">archives/</a> 配下にすべての記事データを置いている。タイトルやタグ、日付などのメタデータは archives/entries.json に記載する。</p>

<h3>ページの生成</h3>
<p>JavaScript で archives/entries.json を読み、記事データを展開している。これらは <a target='_blank' href="https://github.com/comame/blog.comame.xyz/blob/master/assets/js/app.js">assets/js/app.js</a> で処理している。History API を使って動的に URL を書き換えているため、Apache や Nginx で URL のリライトが必要。</p>

<h3>静的ビルド</h3>
<p>ユーザーが閲覧する環境で毎回スクリプトでページを生成するのは筋が悪いため、手元で静的ファイルとしてビルドを行う。ページは JavaScript を使って生成するため、Puppeteer でクロールしてスクリプト実行後の HTML を静的ファイルとして保存している。画像ファイルなどのアセットは、/assets に置いておけば /build/assets にそのままコピーされる。ビルド用のスクリプトは <a target='_blank' href="https://github.com/comame/blog.comame.xyz/blob/master/build.js">build.js</a> である。</p>

<h2>今後の運用</h2>
<p>VSCode で記事を書き、手元でビルドし、GitHub にアップする。あとはビルド済みの静的ファイルを適当に配信すればよい。今回は GitHub Pages で公開することにした。自分の開発環境で記事をかけるため、かなり書きやすくなった。一方で、ビルドをするためだけにローカルサーバを立てなければいけないのは結構面倒くさい。</p>
<p>[追記] Git の post-commit フックを使って、自動的にビルドを走らせるようにしてみた。本当は GitHub Actions を使いたかったが、ビルド用のサーバを立てて、Puppeteer を起動して...とするのは厄介そうだったので妥協策ではある。post-commit フックは <a href="https://github.com/comame/blog.comame.xyz/blob/194b480ee2beec8a75c7638ab7453078faa7aa3f/post-commit" target="_blank">post-commit</a> に置いておく。</p>
<p>[追記] <a href="https://github.com/comame/blog.comame.xyz/tree/master/.github/workflows/build.yml" target="_blank">GitHub Actions</a> で push したときにビルドが走るようにした。</p>

<h2>今後やりたいこと</h2>
<ul>
    <li>Markdown で記事を書けるようにする</li>
    <li>WebP などの画像フォーマットに自動的に変換できるようにする</li>
    <li>OGP に対応</li>
    <li>[DONE] RSS フィードを生成できるようにする</li>
</ul>
</div><div class="share_share__2h1cH"><img alt="共有" src="/icons/share.svg"/><a rel="noopener" target="_blank" title="Twitter で共有" href="https://twitter.com/intent/tweet?text=%E3%83%96%E3%83%AD%E3%82%B0%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%92%E6%96%B0%E3%81%97%E3%81%8F%E3%81%97%E3%81%9F%20(Blogger%20%E3%81%8B%E3%82%89%E3%81%AE%E7%A7%BB%E8%A1%8C)%0a&amp;url=https%3A%2F%2Fblog.comame.xyz%2Fentries%2F2020-03-07%2Fnew-blog-system.html&amp;related=comameito"><img alt="Twitter で共有" src="/icons/twitter_logo.svg"/></a><a rel="noopener" target="_blank" title="Facebook で共有" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.comame.xyz%2Fentries%2F2020-03-07%2Fnew-blog-system.html"><img alt="Facebook で共有" src="/icons/facebook_logo.svg"/></a><a title="URL をコピー" id="url-copy"><img alt="URL をコピー" src="/icons/link.svg"/></a><script async="" src="/js/url-copy.js"></script></div></div><footer class="footer_footer__cDy4s"><small><a href="https://github.com/comame/blog.comame.xyz" target="_blank" rel="noopener"><img alt="GitHub Actions build status" id="build-status" src="https://github.com/comame/blog.comame.xyz/workflows/Build/badge.svg?event=push"/></a></small><small><span>Copyright 2020 <a href="https://comame.xyz">comame</a></span><span><a target="_blank" rel="noopener" href="https://github.com/comame/blog.comame.xyz/blob/master/archives/2020/new-blog-system.html">source</a></span><span><a target="_blank" rel="noopener" href="https://github.com/comame/blog.comame.xyz/commits/master/archives/2020/new-blog-system.html">history</a></span><span><a href="/feed.xml">Feed</a></span></small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"entry":{"entry":"new-blog-system","title":"ブログシステムを新しくした (Blogger からの移行)","date":"2020-03-07","tags":["Blog"],"type":"html"},"text":"\u003cp\u003e新しいブログシステムを作成して、Blogger から移行した。今は静的ファイルとして静的ファイルサーバから配信している。GitHub でソースコードを公開した。\u003ca href=\"https://github.com/comame/blog.comame.xyz\" target=\"_blank\"\u003ecomame/blog.comame.xyz\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003eモチベーション\u003c/h2\u003e\n\u003cul\u003e\n    \u003cli\u003e自分が制御可能な形でデータを置きたかった\u003c/li\u003e\n    \u003cli\u003e自分の慣れているエディタで HTML を書きたかった\u003c/li\u003e\n    \u003cli\u003eBlogger は読み込み速度が少し遅かった\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e仕組み\u003c/h2\u003e\n\n\u003ch3\u003e記事の管理\u003c/h3\u003e\n\u003cp\u003e\u003ca target='_blank' href=\"https://github.com/comame/blog.comame.xyz/tree/master/archives\"\u003earchives/\u003c/a\u003e 配下にすべての記事データを置いている。タイトルやタグ、日付などのメタデータは archives/entries.json に記載する。\u003c/p\u003e\n\n\u003ch3\u003eページの生成\u003c/h3\u003e\n\u003cp\u003eJavaScript で archives/entries.json を読み、記事データを展開している。これらは \u003ca target='_blank' href=\"https://github.com/comame/blog.comame.xyz/blob/master/assets/js/app.js\"\u003eassets/js/app.js\u003c/a\u003e で処理している。History API を使って動的に URL を書き換えているため、Apache や Nginx で URL のリライトが必要。\u003c/p\u003e\n\n\u003ch3\u003e静的ビルド\u003c/h3\u003e\n\u003cp\u003eユーザーが閲覧する環境で毎回スクリプトでページを生成するのは筋が悪いため、手元で静的ファイルとしてビルドを行う。ページは JavaScript を使って生成するため、Puppeteer でクロールしてスクリプト実行後の HTML を静的ファイルとして保存している。画像ファイルなどのアセットは、/assets に置いておけば /build/assets にそのままコピーされる。ビルド用のスクリプトは \u003ca target='_blank' href=\"https://github.com/comame/blog.comame.xyz/blob/master/build.js\"\u003ebuild.js\u003c/a\u003e である。\u003c/p\u003e\n\n\u003ch2\u003e今後の運用\u003c/h2\u003e\n\u003cp\u003eVSCode で記事を書き、手元でビルドし、GitHub にアップする。あとはビルド済みの静的ファイルを適当に配信すればよい。今回は GitHub Pages で公開することにした。自分の開発環境で記事をかけるため、かなり書きやすくなった。一方で、ビルドをするためだけにローカルサーバを立てなければいけないのは結構面倒くさい。\u003c/p\u003e\n\u003cp\u003e[追記] Git の post-commit フックを使って、自動的にビルドを走らせるようにしてみた。本当は GitHub Actions を使いたかったが、ビルド用のサーバを立てて、Puppeteer を起動して...とするのは厄介そうだったので妥協策ではある。post-commit フックは \u003ca href=\"https://github.com/comame/blog.comame.xyz/blob/194b480ee2beec8a75c7638ab7453078faa7aa3f/post-commit\" target=\"_blank\"\u003epost-commit\u003c/a\u003e に置いておく。\u003c/p\u003e\n\u003cp\u003e[追記] \u003ca href=\"https://github.com/comame/blog.comame.xyz/tree/master/.github/workflows/build.yml\" target=\"_blank\"\u003eGitHub Actions\u003c/a\u003e で push したときにビルドが走るようにした。\u003c/p\u003e\n\n\u003ch2\u003e今後やりたいこと\u003c/h2\u003e\n\u003cul\u003e\n    \u003cli\u003eMarkdown で記事を書けるようにする\u003c/li\u003e\n    \u003cli\u003eWebP などの画像フォーマットに自動的に変換できるようにする\u003c/li\u003e\n    \u003cli\u003eOGP に対応\u003c/li\u003e\n    \u003cli\u003e[DONE] RSS フィードを生成できるようにする\u003c/li\u003e\n\u003c/ul\u003e\n"},"__N_SSG":true},"page":"/entries/[date]/[id]","query":{"date":"2020-03-07","id":"new-blog-system"},"buildId":"eaJIyxMmkhvvLZTiksMV8","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e750b8bf0c81a657f011.js"></script><script src="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" async=""></script><script src="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" async=""></script><script src="/_next/static/chunks/framework.ea5d6f7a7099b14097ba.js" async=""></script><script src="/_next/static/chunks/commons.136473f176143783e714.js" async=""></script><script src="/_next/static/chunks/pages/_app-7826aa35c5692e1bca69.js" async=""></script><script src="/_next/static/chunks/44192d0b83adb4471c56c08528820b1f17270e33.228b4631e982fe3bd0c5.js" async=""></script><script src="/_next/static/chunks/pages/entries/%5Bdate%5D/%5Bid%5D-217160f5fe64bb279c4b.js" async=""></script><script src="/_next/static/eaJIyxMmkhvvLZTiksMV8/_buildManifest.js" async=""></script><script src="/_next/static/eaJIyxMmkhvvLZTiksMV8/_ssgManifest.js" async=""></script></body></html>