<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>AdSense の申請をした | blog.comame.xyz</title><meta property="og:type" content="article"/><meta property="og:url" content="https://blog.comame.xyz/entries/2019-09-24/apply-adsense.html"/><meta property="og:title" content="AdSense の申請をした | blog.comame.xyz"/><meta property="og:site_name" content="blog.comame.xyz"/><meta property="og:description" content=""/><meta name="description" content=""/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/75b3a985ae8df8a5857d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/75b3a985ae8df8a5857d.css"/><link rel="preload" href="/_next/static/css/7e552a05a23ef38b9280.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7e552a05a23ef38b9280.css"/><link rel="preload" href="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ea5d6f7a7099b14097ba.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.136473f176143783e714.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7826aa35c5692e1bca69.js" as="script"/><link rel="preload" href="/_next/static/chunks/44192d0b83adb4471c56c08528820b1f17270e33.228b4631e982fe3bd0c5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/entries/%5Bdate%5D/%5Bid%5D-217160f5fe64bb279c4b.js" as="script"/></head><body><div id="__next"><header class="header_header__10AWY"><a href="/">blog.comame.xyz</a></header><div class="post"><div class="metadata_metadata__3aUvp"><h1 id="title">AdSense の申請をした</h1><time id="time">2019-09-24</time><ul class="tag-list_tag-list__1Wf57"><li><a href="/tags/Blog.html">Blog</a></li><li><a href="/tags/Google.html">Google</a></li></ul></div><div class="content_content__3lhGG"><p>今日このブログで AdSense の申請をしましたが、いくつか技術的な問題があったため、それの対処法を紹介します。</p>

<h2>発生した問題</h2>
<p>AdSense の申請をするには当然対象の URL が必要ですが、サブドメインでは申請できないという問題があります。このブログは blog.comame.xyz で配信していましたが、comame.xyz に付け替える必要がありました。<br>
一方、comame.xyz はすでに自前のサーバに割り当てていました。このブログで使用している一部の画像やスクリプトなども comame.xyz から取得していました。そのため、DNS を書き換えるだけではブログのレイアウトが崩れてしまいます。</p>

<h2>状況</h2>
<p>comame.xyz 上では、すでにいくつかのサービスが動いています。一方で、過去に Docker を使用することで複数のサーバに分割させており、Nginx のリバースプロキシを使ってリクエストを振り分けていました。実際の Nginx のコンフィグの一部は以下のようになっていました。<p>
<pre><code>
server {
  location / {
    location / {
       # Docker Compose のサービスの1つとしてホームページを配信していた
       proxy_pass http://home/;
    }
    location /assets {
      # 画像や CSS、JavaScript はここから配信していた
      proxy_pass http://assets/;
    }
  }
}
</code></pre>
<p>この設定ファイルからわかるように、アセット配信サーバとホームページ配信サーバは別のコンテナで実行していました。</p>


<h2>解決策</h2>
<p>ルートディレクトリだけを blog.comame.xyz へのリバースプロキシとすることで解決しました。アセット配信サーバは変わらず /assets で配信しています。</p>
<pre><code>
server {
    location / {
        location / {
            # 今まではコンテナに向けていたものを、blog.comame.xyz に差し替え
            proxy_pass: https://blog.comame.xyz/;

            # TLS 周りのエラーが発生したので
            proxy_ssl_server_name on;
        }
        location /assets {
            # 変更なし
            proxy_pass: http://assets/;
        }
    }
}
</code></pre>

<h2>現状</h2>
<p>DNS をいじったわけではないので、blog.comame.xyz にアクセスすることでもブログにアクセスできます。comame.xyz にアクセスすると、今まで表示されていたホームページではなく、ブログが表示されるようになっています。<br>
次のような流れになっています。<br>
<code>User Agent -> comame.xyz -(Nginx が代理アクセス)-> blog.comame.xyz</code>
</p>

<h2>教訓</h2>
<p>止めると影響が大きいサーバとそうでもないサーバは、分けておいたほうが後々役に立つ (適当)<br>
AdSense の申請通るといいな</p>
</div><div class="share_share__2h1cH"><img alt="共有" src="/icons/share.svg"/><a rel="noopener" target="_blank" title="Twitter で共有" href="https://twitter.com/intent/tweet?text=AdSense%20%E3%81%AE%E7%94%B3%E8%AB%8B%E3%82%92%E3%81%97%E3%81%9F%0a&amp;url=https%3A%2F%2Fblog.comame.xyz%2Fentries%2F2019-09-24%2Fapply-adsense.html&amp;related=comameito"><img alt="Twitter で共有" src="/icons/twitter_logo.svg"/></a><a rel="noopener" target="_blank" title="Facebook で共有" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.comame.xyz%2Fentries%2F2019-09-24%2Fapply-adsense.html"><img alt="Facebook で共有" src="/icons/facebook_logo.svg"/></a><a title="URL をコピー" id="url-copy"><img alt="URL をコピー" src="/icons/link.svg"/></a><script async="" src="/js/url-copy.js"></script></div></div><footer class="footer_footer__cDy4s"><small><a href="https://github.com/comame/blog.comame.xyz" target="_blank" rel="noopener"><img alt="GitHub Actions build status" id="build-status" src="https://github.com/comame/blog.comame.xyz/workflows/Build/badge.svg?event=push"/></a></small><small><span>Copyright 2020 <a href="https://comame.xyz">comame</a></span><span><a target="_blank" rel="noopener" href="https://github.com/comame/blog.comame.xyz/blob/master/archives/2019/apply-adsense.html">source</a></span><span><a target="_blank" rel="noopener" href="https://github.com/comame/blog.comame.xyz/commits/master/archives/2019/apply-adsense.html">history</a></span><span><a href="/feed.xml">Feed</a></span></small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"entry":{"entry":"apply-adsense","title":"AdSense の申請をした","date":"2019-09-24","tags":["Blog","Google"],"type":"html"},"text":"\u003cp\u003e今日このブログで AdSense の申請をしましたが、いくつか技術的な問題があったため、それの対処法を紹介します。\u003c/p\u003e\n\n\u003ch2\u003e発生した問題\u003c/h2\u003e\n\u003cp\u003eAdSense の申請をするには当然対象の URL が必要ですが、サブドメインでは申請できないという問題があります。このブログは blog.comame.xyz で配信していましたが、comame.xyz に付け替える必要がありました。\u003cbr\u003e\n一方、comame.xyz はすでに自前のサーバに割り当てていました。このブログで使用している一部の画像やスクリプトなども comame.xyz から取得していました。そのため、DNS を書き換えるだけではブログのレイアウトが崩れてしまいます。\u003c/p\u003e\n\n\u003ch2\u003e状況\u003c/h2\u003e\n\u003cp\u003ecomame.xyz 上では、すでにいくつかのサービスが動いています。一方で、過去に Docker を使用することで複数のサーバに分割させており、Nginx のリバースプロキシを使ってリクエストを振り分けていました。実際の Nginx のコンフィグの一部は以下のようになっていました。\u003cp\u003e\n\u003cpre\u003e\u003ccode\u003e\nserver {\n  location / {\n    location / {\n       # Docker Compose のサービスの1つとしてホームページを配信していた\n       proxy_pass http://home/;\n    }\n    location /assets {\n      # 画像や CSS、JavaScript はここから配信していた\n      proxy_pass http://assets/;\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこの設定ファイルからわかるように、アセット配信サーバとホームページ配信サーバは別のコンテナで実行していました。\u003c/p\u003e\n\n\n\u003ch2\u003e解決策\u003c/h2\u003e\n\u003cp\u003eルートディレクトリだけを blog.comame.xyz へのリバースプロキシとすることで解決しました。アセット配信サーバは変わらず /assets で配信しています。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\nserver {\n    location / {\n        location / {\n            # 今まではコンテナに向けていたものを、blog.comame.xyz に差し替え\n            proxy_pass: https://blog.comame.xyz/;\n\n            # TLS 周りのエラーが発生したので\n            proxy_ssl_server_name on;\n        }\n        location /assets {\n            # 変更なし\n            proxy_pass: http://assets/;\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003e現状\u003c/h2\u003e\n\u003cp\u003eDNS をいじったわけではないので、blog.comame.xyz にアクセスすることでもブログにアクセスできます。comame.xyz にアクセスすると、今まで表示されていたホームページではなく、ブログが表示されるようになっています。\u003cbr\u003e\n次のような流れになっています。\u003cbr\u003e\n\u003ccode\u003eUser Agent -\u003e comame.xyz -(Nginx が代理アクセス)-\u003e blog.comame.xyz\u003c/code\u003e\n\u003c/p\u003e\n\n\u003ch2\u003e教訓\u003c/h2\u003e\n\u003cp\u003e止めると影響が大きいサーバとそうでもないサーバは、分けておいたほうが後々役に立つ (適当)\u003cbr\u003e\nAdSense の申請通るといいな\u003c/p\u003e\n"},"__N_SSG":true},"page":"/entries/[date]/[id]","query":{"date":"2019-09-24","id":"apply-adsense"},"buildId":"jDBZLSj746eKq-OsCmnvw","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e750b8bf0c81a657f011.js"></script><script src="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" async=""></script><script src="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" async=""></script><script src="/_next/static/chunks/framework.ea5d6f7a7099b14097ba.js" async=""></script><script src="/_next/static/chunks/commons.136473f176143783e714.js" async=""></script><script src="/_next/static/chunks/pages/_app-7826aa35c5692e1bca69.js" async=""></script><script src="/_next/static/chunks/44192d0b83adb4471c56c08528820b1f17270e33.228b4631e982fe3bd0c5.js" async=""></script><script src="/_next/static/chunks/pages/entries/%5Bdate%5D/%5Bid%5D-217160f5fe64bb279c4b.js" async=""></script><script src="/_next/static/jDBZLSj746eKq-OsCmnvw/_buildManifest.js" async=""></script><script src="/_next/static/jDBZLSj746eKq-OsCmnvw/_ssgManifest.js" async=""></script></body></html>